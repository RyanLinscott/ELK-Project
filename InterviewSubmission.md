# Interview Question 

## Domain Network Security

_Question: Faulty Firewall_

Setting up a firewall to block unauthorized SSH connections is a very important task to ensure servers are properly secure from outsider threats.  In my most recent project access to my jump box, three web servers and an ELK server were all originally set up for access by SSH.  It is important to note though that even though these servers were accepting SSH services, there were rules set in place through my Azure security group that required proper authorization to gain access to the servers.  Any IP which was not whitelisted would not be allowed to SSH to the servers.  I set the rule to only allow SSH services from my own personal host computer to the jump box.  Simply having the web servers IP address and username of the server is not enough to SSH, each server also needed the key of a docker ansible container located on the jump boc in order to be accessable.  Trying to access any of the web servers from any source other than my jump box would result in a connection timeout being refused.  This was setup so that in order to gain access to the network, which would be considered vulnerable, would require a combination of my host computers private RSA key and the RSA of the ansible container.  Only then could I have permission as permitted by my Azure security group to allow my personal IP through the firewall and gain access to the jump box.

At any point if one of my servers was somehow able to be accessed from any device other than my own personal computer the first place I would look would be in my Azure security group rules where it is defined that the only computer able to SSH to my jump box is my host computer.  I would ensure that the only allowed SSH service is being permitted from my personal IP address.  Once inside the jump box, the user must start the ansible container, only from there would a user be able to SSH into one of the web servers or the ELK server.  If access to one of the servers was granted without needing to be inside the ansible container I would immediately create a new RSA key from my ansible container and add it to all the web servers, removing any old keys which might be compromised. The rules laid out in the security group I made in Azure made lateral movements between web servers from one to another unavailable as each server required the key stored within the ansible container to SSH.  To ensure all services were properly functioning and SSH was not being allowed from web server to web server, or my host to web server, I tested each connection verifying that the only SSH connections which were functioning were those that met my Azure security group rules.

In order to properly check my security group rules in Azure I would first locate the _"Resource Group"_ that I was setting my rules for.  From there I would navigate to the _"Network security groups"_ area.  Searching within the area should show the security group I originally made.  I would click on the name of the security group and just once again doouble check that it is linked to the correct Resource Group and region it is protecting.  If that is as it should be my next step would be to click on the _"Inbound security rules"_ link on the left side of the page.  It is important that the rules I set were as inbound not outbound as we were hardening the system to protect from outside risks and trying to limit the availability.  Once inside the _"Inbound security rules"_ area you should see a list of both user created and Azure default security rules.  If there are no user created rules listed, then navigate to _"+Add"_ and create a new rule from scratch.  It doesn't require much time and is important to ensure the security of your network.

I would then check my rules and make sure that my rules are as followed:
- _Allow SSH to Jump Box from Host Only:_ 

    For this rule it is important that the source is set as your personal IP address (which can be found at whatsmyip.org) and the destination is the public IP of your jump box.  It will use the SSH service, which should be set default to Port: 22, the action you will then set will be "Allow".

- _Allow SSH from Jump Box to Virtual Network:_ 

    This rule is what helps ensure that only your jump box has access to the virtual network.  To ensure this your will set the source to be your jump box and the destination will be your virtual network, using SSH as the service.  Again you will set the action as "Allow". 

After setting these rules it is important to check the priorities of each rule.  If the priorities are not properly set then you might allow unwanted activity onto the network by accident because it is allowed through a lower priority.  If you have the rules set in place and all the keys are properly distributed you can go to the _"Virtual Machines"_ link from the base of your resource group and test the connection by clicking the name of the specific machine you are trying to connect to.  Ensure that the status is displayed as _"Running"_ then clicking the "_Connect"_ link, once the drop down menu appears click on  _"SSH"_.  From there Azure will test the SSH connectiviity and let you know if the service is running as intended.

Even with all the proper security rules set in place in Azure, there is not a 100% guarentee that your servers are immune to unauthorized access.  These rules are great for laying the foundation of a solid firewall to protect these web servers.  Given enough time and persistence I am sure a threat actor could gain access to the network, but the ELK server which was configured along side of the network is designed to log the metrics and changes to log files which any threat would leave behind.  While this might not be enough to prevent the network from getting hacked into, it will at least leave a detailed trace of what was happening while it was under attack.  The only way a threat should theoretically be able to access the network would be if somehow they managed to gain access to my private computer, personal home IP and RSA key.  Once on the servers though it should log the data being used on the ELK server that I could analyze once I was able to access it, which I could do by changing the inbound security rules on my ELK specific security group.  Once I gained access to the logs and metrics I could re-instate the rules that lock the server down, even deny all traffic to and from it.

The "network of the future" brings a higher accessability than traditional networks have ever.  With higher accessability comes the need for stricter rules for protection.  As long as there is information someone wants, there will be someone trying to offiscate it.  A properly configured firewall can only protect you as long as your employees are also following safe practices, these rules will only be as good as the people who are following safe network practices.   
